% many historical definitions, AJR, Feb 2021
\ifx\text\@undefined
\typeout{**** command text undefined, prefer use package amsmath}
\newcommand{\text}[1]{\mbox{#1}}
\newcommand{\operatorname}[1]{\mbox{#1}}
\fi
% defines commonly used commands.
%\newcommand{\D}[2]{\frac{\partial #2}{\partial #1}}
\newcommand{\D}[2]{\mathchoice
  {\frac{\partial #2}{\partial #1}}% display
  {{\partial #2}/{\partial #1}}% text
  {{\partial #2}/{\partial #1}}% script
  {{\partial #2}/{\partial #1}}% scriptscript
  }
%\newcommand{\Dn}[3]{\frac{\partial^#2 #3}{\partial #1^#2}}
\newcommand{\Dn}[3]{\mathchoice
  {\frac{\partial^{#2} #3}{\partial #1^{#2}}}%
  {{\partial^{#2} #3}/{\partial #1^{#2}}}%
  {{\partial^{#2} #3}/{\partial #1^{#2}}}%
  {{\partial^{#2} #3}/{\partial #1^{#2}}}%
  }
\newcommand{\DD}[2]{\Dn{#1}2{#2}}
\newcommand{\DDD}[2]{\Dn{#1}3{#2}}
\newcommand{\DDDD}[2]{\Dn{#1}4{#2}}
\newcommand{\Dx}[3]{\mathchoice
  {\frac{\partial^2 #3}{\partial #1 \partial #2}}%
  {{\partial^2 #3}/{\partial #1 \partial #2}}%
  {{\partial^2 #3}/{\partial #1 \partial #2}}%
  {{\partial^2 #3}/{\partial #1 \partial #2}}%
  }
\newcommand{\de}[2]{\mathchoice
  {\frac{d #2}{d #1}}% display
  {{d #2}/{d #1}}% text
  {{d #2}/{d #1}}% script
  {{d #2}/{d #1}}% scriptscript
  }
\newcommand{\dn}[3]{\mathchoice
  {\frac{d^{#2} #3}{d #1^{#2}}}%
  {{d^{#2} #3}/{d #1^{#2}}}%
  {{d^{#2} #3}/{d #1^{#2}}}%
  {{d^{#2} #3}/{d #1^{#2}}}%
  }
\newcommand{\dd}[2]{\dn{#1}2{#2}}
\newcommand{\ddd}[2]{\dn{#1}3{#2}}
\newcommand{\dddd}[2]{\dn{#1}4{#2}}
%\renewcommand{\vec}[1]{\boldsymbol{#1}}
\newcommand{\qtq}[1]{\quad\text{#1}\quad}
% \renewcommand{\vec}[1]{\mathbf{#1}}
% need to use \(\) in the following as otherwise \listoftables and \listoffigures
% gets stuffed up.  And even then, with captions one still has to put these into $...$
% and not anything else!
%\newcommand{\Ord}[1]{\ensuremath{\mathcal O\big(#1\big)}}
\newcommand{\Ord}[1]{\ensuremath{\mathcal O
\mathchoice{\big(#1\big)}{\big(#1\big)}{(#1)}{(#1)}
}}
\newcommand{\ord}[1]{\ensuremath{o\big(#1\big)}}
%\newcommand{\Ord}[1]{\ifmmode\mathcal O\big(#1\big)
%\else\(\mathcal O\big(#1\big)\)\fi}
%\newcommand{\ord}[1]{\ifmmode o\big(#1\big)
%\else\(o\big(#1\big)\)\fi}
\newcommand{\divv}{\vec\nabla\cdot}
\newcommand{\grad}{\vec\nabla}
\newcommand{\curl}{\vec\nabla\times}
\newcommand{\delsq}{\nabla^{2}}
\ifx\iint\@undefined\newcommand{\iint}{\int\!\!\!\int}\fi
\ifx\iiint\@undefined\newcommand{\iiint}{\int\!\!\!\int\!\!\!\int}\fi
\newcommand{\etal}{{et al.}}

% for bibliography
\def\arcproject#1{}
\def\arcstatement#1{}

% % stroked fractions
% \newcommand{\strokefrac}[2]{\leavevmode\kern.1em
% \raise.5ex\hbox{\the\scriptfont0 #1}\kern-.1em
% /\kern-.15em\lower.25ex\hbox{\the\scriptfont0 #2}}
\newcommand{\half}{\mbox{$\frac12$}}
\newcommand{\third}{\mbox{$\frac13$}}
\newcommand{\quarter}{\mbox{$\frac14$}}
\newcommand{\sfrac}[2]{{\tfrac{#1}{#2}}}
\newcommand{\rat}[2]{{\tfrac{#1}{#2}}}

\newcommand{\sde}{\textsc{sde}}
\newcommand{\spde}{\textsc{spde}}
\newcommand{\ode}{\textsc{ode}}
\newcommand{\pde}{\textsc{pde}}
\newcommand{\Reduce}{{Reduce}}
\newcommand{\Matlab}{\textsc{Matlab}}
\ifx\matlab\@undefined
\newcommand{\matlab}{\textsc{Matlab}}
\fi

% units
\newcommand{\m}{\operatorname{m}}
\newcommand{\cm}{\operatorname{cm}}
\newcommand{\mm}{\operatorname{mm}}
\newcommand{\secs}{\operatorname{s}}
\newcommand{\gm}{\operatorname{gm}}
\newcommand{\kg}{\operatorname{kg}}
\newcommand{\kJ}{\operatorname{kJ}}
\newcommand{\W}{\operatorname{W}}
\newcommand{\N}{\operatorname{N}}
\newcommand{\K}{\operatorname{{}^{\circ}K}}
%\newcommand{\C}{\operatorname{{}^{\circ}C}}% incompatible with something
% well known constants
\newcommand{\re}{\operatorname{Re}}
\newcommand{\we}{\operatorname{We}}
\newcommand{\gr}{\operatorname{Gr}}
\newcommand{\fr}{\operatorname{Fr}}


% verbatimlisting for computer code
\makeatletter
\newcounter{lineno}
\def\verbatimlisting#1{\setcounter{lineno}{0}%
    \begingroup{\footnotesize} \@verbatim \frenchspacing 
	\@vobeyspaces \parindent=20pt
    \everypar{\stepcounter{lineno}\llap{\thelineno\ \ }}\input#1
    \endgroup
}
\makeatother

% default graphics
% \usepackage{graphicx}
%\setkeys{Gin}{width=0.9\textwidth,height=0.7\textheight,keepaspectratio}

% by default use url package
% \usepackage{url}

%\def\doi{}
%\ifx\href\undefined
%     \renewcommand{\doi}[1]{\url{http://dx.doi.org/#1}}
%\else\renewcommand{\doi}[1]{\href{http://dx.doi.org/#1}{doi:#1}}
%\fi
%\RequirePackage{doi}% doi file does hyperef things which screws 

% define some useful indexing commands
\ifx\idx\undefined%
  \newcommand{\idx}[2][]{#2\index{#2!#1}}\fi
\ifx\emidx\undefined%
  \newcommand{\emidx}[1]{\emph{#1}\index{#1|emph}}\fi
\ifx\bfidx\undefined%
  \newcommand{\bfidx}[1]{\textbf{#1}\index{#1|textbf}}\fi

% some commonly used environments
\ifx\theorem\undefined
\RequirePackage{amsthm}
\RequirePackage{aliascnt}% for autoref of things in theorems
\def\theoremcolour{} % hook
\newtheorem{theorem}{\theoremcolour Theorem}
\topsep=\parskip
%\newtheorem{corollary}[theorem]{\theoremcolour Corollary}
    \newaliascnt{corollary}{theorem}
    \newtheorem{corollary}[corollary]{\theoremcolour Corollary}
    \aliascntresetthe{corollary}
    \def\corollaryautorefname{Corollary}
%\newtheorem{lemma}[theorem]{\theoremcolour Lemma}
    \newaliascnt{lemma}{theorem}
    \newtheorem{lemma}[lemma]{\theoremcolour Lemma}
    \aliascntresetthe{lemma}
    \def\lemmaautorefname{Lemma}
%\newtheorem{proposition}[theorem]{\theoremcolour Proposition}
    \newaliascnt{proposition}{theorem}
    \newtheorem{proposition}[proposition]{\theoremcolour Proposition}
    \aliascntresetthe{proposition}
    \def\propositionautorefname{Proposition}
%\newtheorem{conjecture}[theorem]{\theoremcolour conjecture}
    \newaliascnt{conjecture}{theorem}
    \newtheorem{conjecture}[conjecture]{\theoremcolour Conjecture}
    \aliascntresetthe{conjecture}
    \def\conjectureautorefname{Conjecture}
%\newtheorem{hypothesis}[theorem]{\theoremcolour Hypothesis}
    \newaliascnt{hypothesis}{theorem}
    \newtheorem{hypothesis}[hypothesis]{\theoremcolour Hypothesis}
    \aliascntresetthe{hypothesis}
    \def\hypothesisautorefname{Hypothesis}
%\newtheorem{assumption}[theorem]{\theoremcolour Assumption}
    \newaliascnt{assumption}{theorem}
    \newtheorem{assumption}[assumption]{\theoremcolour Assumption}
    \aliascntresetthe{assumption}
    \def\assumptionautorefname{Assumption}
%\newtheorem{definition}[theorem]{\theoremcolour Definition}
    \newaliascnt{definition}{theorem}
    \newtheorem{definition}[definition]{\theoremcolour Definition}
    \aliascntresetthe{definition}
    \def\definitionautorefname{Definition}
%\theoremstyle{definition}
\theoremstyle{remark}
\newtheorem{remark}{Remark}
\makeatletter% do not understand why this is needed
\let\example\@undefined
\let\endexample\@undefined
\makeatother
\newtheorem{example}{Example}
    \def\exampleautorefname{Example}
\fi

% environment quoted gives an attributed quote with the attribution
% appearing on the last line and supplied by the argument to the
% environment (the TeX is adapted from something by Knuth)
\newsavebox{\ajrquoted}
\let\quoted\relax\let\endquoted\relax
\newenvironment{quoted}[1]{\begin{quote}\savebox{\ajrquoted}{\em #1}}%
{\hfill\penalty50\quad\mbox{}\hfill\usebox{\ajrquoted}\penalty-10000\end{quote}}

%% Provide a command to hook into any environment.
%% Useful to colour questions from previous years
%% as in \atBegin{2012}{\colour{magenta}} for example.
%%  10 Sep 2013.
\let\atBegin\relax\let\endatBegin\relax
\newcommand{\atBegin}[2]{%
  \expandafter\ifx\csname#1h@@ka\endcsname\relax%
    \expandafter\let\csname#1h@@ka\expandafter\endcsname%
      \csname#1\endcsname%
    \expandafter\def\csname#1\endcsname%
      {#2\csname#1h@@ka\endcsname}%
  \else%
  \expandafter\ifx\csname#1h@@kb\endcsname\relax%
    \expandafter\let\csname#1h@@kb\expandafter\endcsname%
      \csname#1\endcsname%
    \expandafter\def\csname#1\endcsname%
      {#2\csname#1h@@kb\endcsname}%
  \else\IgnoringTooManyAtBeginsForThisCommand%
  \fi\fi%
  }


%% Provide commands to consistently define vecs et al. Mar 2018
%% finds first char and the rest of a string
\def\ajrSplit#1#2\ajrEndSplit{\def\ajrcar{#1}\def\ajrcdr{#2}}
%% used for making command names appear, override to stop
%% DNW in sub-superscripts??
%\def\RaisedName#1{\ensuremath{\mathchoice{}{\raisebox{1.5ex}{\smash{\rlap{%
%    \texttt{\footnotesize\color{red}#1}%
%    }}}}{}{}}}
\newif\ifRaisedNames
\RaisedNamestrue % Switch to false to omit
\def\RaisedName#1{\ifRaisedNames%
    \raisebox{1.5ex}{\smash{\rlap{%
    \texttt{\footnotesize\color{magenta!70!white}#1}%
    }}}\fi}
%\def\RaisedName#1{}% or cancel it
%% Now define \Vec for vectors
\def\Vec{}
\renewcommand{\Vec}[1]{%
  \typeout{**** Command #1v denotes vector #1}%
  \expandafter\ajrSplit#1\ajrEndSplit%
  \ifx\ajrcdr\empty % single character
    \expandafter\DeclareRobustCommand\csname#1v\endcsname%
    {{\RaisedName{\ensuremath{\backslash}#1v}% put name above
      \ensuremath{\ifx#1i \vec\imath
        \else\ifx#1j \vec\jmath
        \else\vec #1\fi\fi}% end of typeset it
      \global\csname UsedVec#1true\endcsname% record when used
    }}%
  \else % multicharacter e.g. greek
    \expandafter\DeclareRobustCommand\csname#1v\endcsname%
    {{\ensuremath{\vec{\csname#1\endcsname}}}% record when used
      \global\csname UsedVec#1true\endcsname}%
  \fi%
  % establish the if-used flag
  \expandafter\newif\csname ifUsedVec#1\endcsname
  \csname UsedVec#1false\endcsname
  % type message if not used
  \AtEndDocument{\csname ifUsedVec#1\endcsname\else
  \typeout{**** Vec symbol #1v not used.}
  \fi}
  }
%% to define blackboard bold, fraktur, cal symbols
%% Now with check to see if used.
\RequirePackage{amsfonts}
\newcommand{\Bb}[1]{% define symbol #1#1
  \typeout{**** Command #1#1 denotes mathbb #1 for vector spaces}%
  \expandafter\DeclareRobustCommand\csname #1#1\endcsname%
  {\RaisedName{\ensuremath{\backslash}#1#1}% put name above
  \ensuremath{\mathbb #1}% typeset it
  \global\csname UsedBb#1true\endcsname% record when used
  }% end defn of \#1#1
  % establish the if-used flag
  \expandafter\newif\csname ifUsedBb#1\endcsname
  \csname UsedBb#1false\endcsname
  % type message if not used
  \AtEndDocument{\csname ifUsedBb#1\endcsname\else
  \typeout{**** Bb symbol #1#1 not used.}
  \fi}
  }
\newcommand{\Frak}[1]{% define symbol f#1
  \typeout{**** Command f#1 denotes fraktur #1}%
  \expandafter\DeclareRobustCommand\csname f#1\endcsname%
  {\ensuremath{\mathfrak #1}% record when used
  \global\csname UsedFrak#1true\endcsname}%
  % establish the if-used flag
  \expandafter\newif\csname ifUsedFrak#1\endcsname
  \csname UsedFrak#1false\endcsname
  % type message if not used
  \AtEndDocument{\csname ifUsedFrak#1\endcsname\else
  \typeout{**** Frak symbol f#1 not used.}
  \fi}
  }
\newcommand{\Cal}[1]{% define symbol c#1
  \typeout{**** Command c#1 denotes calligraphic #1}%
  \expandafter\DeclareRobustCommand\csname c#1\endcsname%
  {\RaisedName{\detokenize{\c}\hspace{-0.5em}#1}% put name above
  \ensuremath{\mathcal #1}% typeset it
  \global\csname UsedCal#1true\endcsname  % record when used
  }%end defn of \c#1
  % establish the if-used flag
  \expandafter\newif\csname ifUsedCal#1\endcsname
  \csname UsedCal#1false\endcsname
  % type message if not used
  \AtEndDocument{\csname ifUsedCal#1\endcsname\else
  \typeout{**** Cal symbol c#1 not used.}
  \fi}
  }


%% for small matrices given amsmath
\newenvironment{bmat}{\left[\begin{smallmatrix} }%
    {\end{smallmatrix}\right]}
\newenvironment{vmat}{\left|\begin{smallmatrix} }%
    {\end{smallmatrix}\right|}
    
% upright differential in maths mode, Apr 2019
\makeatletter\let\d@TextMode\d\makeatother
\def\d#1{\relax\ifmmode\operatorname{d}\!#1%
        \else\d@TextMode#1\fi}
% and define upright i
\def\i{\operatorname{i}}
% and define upright e
\def\e{\operatorname{e}}
% define a flexible comma for math mode
\def\C{\mathchar"213B}


% set an if to see if draft specified
%\newif\ifisDraft
%\ifdim\overfullrule>0pt\isDrafttrue
%\else\isDraftfalse
%\fi

