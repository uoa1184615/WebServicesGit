\ifx\text\@undefined
\typeout{**** command text undefined, prefer use package amsmath}
\newcommand{\text}[1]{\mbox{#1}}
\newcommand{\operatorname}[1]{\mbox{#1}}
\fi
% defines commonly used commands.
%\newcommand{\D}[2]{\frac{\partial #2}{\partial #1}}
\newcommand{\D}[2]{\mathchoice
  {\frac{\partial #2}{\partial #1}}% display
  {{\partial #2}/{\partial #1}}% text
  {{\partial #2}/{\partial #1}}% script
  {{\partial #2}/{\partial #1}}% scriptscript
  }
%\newcommand{\Dn}[3]{\frac{\partial^#2 #3}{\partial #1^#2}}
\newcommand{\Dn}[3]{\mathchoice
  {\frac{\partial^{#2} #3}{\partial #1^{#2}}}%
  {{\partial^{#2} #3}/{\partial #1^{#2}}}%
  {{\partial^{#2} #3}/{\partial #1^{#2}}}%
  {{\partial^{#2} #3}/{\partial #1^{#2}}}%
  }
\newcommand{\DD}[2]{\Dn{#1}2{#2}}
\newcommand{\DDD}[2]{\Dn{#1}3{#2}}
\newcommand{\DDDD}[2]{\Dn{#1}4{#2}}
\newcommand{\Dx}[3]{\mathchoice
  {\frac{\partial^2 #3}{\partial #1 \partial #2}}%
  {{\partial^2 #3}/{\partial #1 \partial #2}}%
  {{\partial^2 #3}/{\partial #1 \partial #2}}%
  {{\partial^2 #3}/{\partial #1 \partial #2}}%
  }
\newcommand{\de}[2]{\mathchoice
  {\frac{d #2}{d #1}}% display
  {{d #2}/{d #1}}% text
  {{d #2}/{d #1}}% script
  {{d #2}/{d #1}}% scriptscript
  }
\newcommand{\dn}[3]{\mathchoice
  {\frac{d^{#2} #3}{d #1^{#2}}}%
  {{d^{#2} #3}/{d #1^{#2}}}%
  {{d^{#2} #3}/{d #1^{#2}}}%
  {{d^{#2} #3}/{d #1^{#2}}}%
  }
\newcommand{\dd}[2]{\dn{#1}2{#2}}
\newcommand{\ddd}[2]{\dn{#1}3{#2}}
\newcommand{\dddd}[2]{\dn{#1}4{#2}}
%\renewcommand{\vec}[1]{\text{\boldmath$#1$}}
\newcommand{\qtq}[1]{\quad\text{#1}\quad}
% \renewcommand{\vec}[1]{\mathbf{#1}}
% need to use \(\) in the following as otherwise \listoftables and \listoffigures
% gets stuffed up.  And even then, with captions one still has to put these into $...$
% and not anything else!
%\newcommand{\Ord}[1]{\ensuremath{\mathcal O\big(#1\big)}}
\newcommand{\Ord}[1]{\ensuremath{\mathcal O
\mathchoice{\big(#1\big)}{\big(#1\big)}{(#1)}{(#1)}
}}
\newcommand{\ord}[1]{\ensuremath{o\big(#1\big)}}
%\newcommand{\Ord}[1]{\ifmmode\mathcal O\big(#1\big)
%\else\(\mathcal O\big(#1\big)\)\fi}
%\newcommand{\ord}[1]{\ifmmode o\big(#1\big)
%\else\(o\big(#1\big)\)\fi}
\newcommand{\divv}{\vec\nabla\cdot}
\newcommand{\grad}{\vec\nabla}
\newcommand{\curl}{\vec\nabla\times}
\newcommand{\delsq}{\nabla^{2}}
\ifx\iint\@undefined\newcommand{\iint}{\int\!\!\!\int}\fi
\ifx\iiint\@undefined\newcommand{\iiint}{\int\!\!\!\int\!\!\!\int}\fi
\newcommand{\etal}{{et al.}}

% for bibliography
\def\arcproject#1{}
\def\arcstatement#1{}

% % stroked fractions
% \newcommand{\strokefrac}[2]{\leavevmode\kern.1em
% \raise.5ex\hbox{\the\scriptfont0 #1}\kern-.1em
% /\kern-.15em\lower.25ex\hbox{\the\scriptfont0 #2}}
\newcommand{\half}{\mbox{$\frac12$}}
\newcommand{\third}{\mbox{$\frac13$}}
\newcommand{\quarter}{\mbox{$\frac14$}}
\newcommand{\sfrac}[2]{{\textstyle\frac{#1}{#2}}}
\newcommand{\rat}[2]{{\textstyle\frac{#1}{#2}}}

\newcommand{\sde}{\textsc{sde}}
\newcommand{\spde}{\textsc{spde}}
\newcommand{\ode}{\textsc{ode}}
\newcommand{\pde}{\textsc{pde}}
\newcommand{\Reduce}{{Reduce}}
\newcommand{\matlab}{{Matlab}}

% units
\newcommand{\m}{\operatorname{m}}
\newcommand{\cm}{\operatorname{cm}}
\newcommand{\mm}{\operatorname{mm}}
\newcommand{\secs}{\operatorname{s}}
\newcommand{\gm}{\operatorname{gm}}
\newcommand{\kg}{\operatorname{kg}}
\newcommand{\kJ}{\operatorname{kJ}}
\newcommand{\W}{\operatorname{W}}
\newcommand{\N}{\operatorname{N}}
\newcommand{\K}{\operatorname{{}^{\circ}K}}
\newcommand{\C}{\operatorname{{}^{\circ}C}}
% well known constants
\newcommand{\re}{\operatorname{Re}}
\newcommand{\we}{\operatorname{We}}
\newcommand{\gr}{\operatorname{Gr}}
\newcommand{\fr}{\operatorname{Fr}}


% verbatimlisting for computer code
\makeatletter
\newcounter{lineno}
\def\verbatimlisting#1{\setcounter{lineno}{0}%
    \begingroup{\footnotesize} \@verbatim \frenchspacing 
	\@vobeyspaces \parindent=20pt
    \everypar{\stepcounter{lineno}\llap{\thelineno\ \ }}\input#1
    \endgroup
}
\makeatother

% default graphics
% \usepackage{graphicx}
%\setkeys{Gin}{width=0.9\textwidth,height=0.7\textheight,keepaspectratio}

% by default use url package
% \usepackage{url}

%\def\doi{}
%\ifx\href\undefined
%     \renewcommand{\doi}[1]{\url{http://dx.doi.org/#1}}
%\else\renewcommand{\doi}[1]{\href{http://dx.doi.org/#1}{doi:#1}}
%\fi
\RequirePackage{doi}

% define some useful indexing commands
\ifx\idx\undefined%
  \newcommand{\idx}[2][]{#2\index{#2!#1}}\fi
\ifx\emidx\undefined%
  \newcommand{\emidx}[1]{\emph{#1}\index{#1|emph}}\fi
\ifx\bfidx\undefined%
  \newcommand{\bfidx}[1]{\textbf{#1}\index{#1|textbf}}\fi

% some commonly used environments
\ifx\theorem\undefined
\RequirePackage{amsthm}
\def\theoremcolour{} % hook
\newtheorem{theorem}{\theoremcolour Theorem}
\topsep=\parskip
\newtheorem{corollary}[theorem]{\theoremcolour Corollary}
\newtheorem{lemma}[theorem]{\theoremcolour Lemma}
\newtheorem{proposition}[theorem]{\theoremcolour Proposition}
\theoremstyle{definition}
\newtheorem{hypothesis}[theorem]{\theoremcolour Hypothesis}
\newtheorem{assumption}[theorem]{\theoremcolour Assumption}
\newtheorem{definition}[theorem]{\theoremcolour Definition}
\theoremstyle{remark}
\newtheorem{remark}{Remark}
\makeatletter% do not understand why this is needed
\let\example\@undefined
\let\endexample\@undefined
\makeatother
\newtheorem{example}{Example}
%\newenvironment{proof}%
%{\par\emph{\theoremcolour Proof:\quad}}%
%%{\hfill{\theoremcolour$\spadesuit$}\par}
%{\hfill\penalty50\quad\mbox{}\hfill\theoremcolour$\spadesuit$\penalty-10000}
\fi

% environment quoted gives an attributed quote with the attribution
% appearing on the last line and supplied by the argument to the
% environment (the TeX is adapted from something by Knuth)
\newsavebox{\ajrquoted}
\let\quoted\relax\let\endquoted\relax
\newenvironment{quoted}[1]{\begin{quote}\savebox{\ajrquoted}{\em #1}}%
{\hfill\penalty50\quad\mbox{}\hfill\usebox{\ajrquoted}\penalty-10000\end{quote}}

%% Provide a command to hook into any environment.
%% Useful to colour questions from previous years
%% as in \atBegin{2012}{\colour{magenta}} for example.
%% Hopefully this version is more reliable, 10 Sep 2013.
\let\atBegin\relax\let\endatBegin\relax
\newcommand{\atBegin}[2]{%
  \expandafter\ifx\csname#1h@@ka\endcsname\relax%
    \expandafter\let\csname#1h@@ka\expandafter\endcsname%
      \csname#1\endcsname%
    \expandafter\def\csname#1\endcsname%
      {#2\csname#1h@@ka\endcsname}%
  \else%
  \expandafter\ifx\csname#1h@@kb\endcsname\relax%
    \expandafter\let\csname#1h@@kb\expandafter\endcsname%
      \csname#1\endcsname%
    \expandafter\def\csname#1\endcsname%
      {#2\csname#1h@@kb\endcsname}%
  \else\IgnoringTooManyAtBeginsForThisCommand%
  \fi\fi%
  }
%\newcommand{\atBegin}[2]{%
%  \@ifundefined{#1h@@ka}{%
%    \expandafter\let\csname#1h@@ka\expandafter\endcsname%
%      \csname#1\endcsname
%    \expandafter\def\csname#1\endcsname%
%      {#2\csname#1h@@ka\endcsname}%
%  }{\@ifundefined{#1h@@kb}{%
%    \expandafter\let\csname#1h@@kb\expandafter\endcsname%
%      \csname#1\endcsname
%    \expandafter\def\csname#1\endcsname%
%      {#2\csname#1h@@kb\endcsname}%
%  }{\IgnoringTooManyAtBeginsForThisCommand%
%  }%endifundefined
%  }%endifundefined
%  }
%\newcommand{\atBegin}[2]{
%  \expandafter\let\csname#1h@@k\expandafter\endcsname\csname#1\endcsname
%  \expandafter\def\csname#1\endcsname{#2\csname#1h@@k\endcsname}
%  }

\def\Vec{}
\renewcommand{\Vec}[1]{%
  \expandafter\def\csname#1v\endcsname%
  {\ensuremath{\vec #1}}}
\newcommand{\Bb}[1]{%
  \expandafter\def\csname#1#1\endcsname%
  {\ensuremath{\mathbb #1}}}
\newcommand{\Frak}[1]{%
  \expandafter\def\csname f#1\endcsname%
  {\ensuremath{\mathfrak #1}}}
\newcommand{\Cal}[1]{%
  \expandafter\def\csname c#1\endcsname%
  {\ensuremath{\mathcal #1}}}
